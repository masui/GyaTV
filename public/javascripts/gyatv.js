// Generated by CoffeeScript 2.5.1

// スライドショー表示「GyaTV 」
// http://GyaTV.com

var checkAndRun, displayNext, iframes, imgdivs, loadNext, loadPage, rand;

iframes = [0, 1, 2].map(function() {
  return $('<iframe frameborder="0" marginwidth="0">').appendTo($('body'));
});

imgdivs = [0, 1, 2].map(function() {
  return $('<div class="imagediv" align="center">').append($('<img>')).appendTo($('body'));
});

rand = function(n) {
  return Math.floor(Math.random() * n);
};

loadNext = function(params, seq) {
  var url;
  window.pageIndex = seq ? window.pageIndex != null ? (window.pageIndex + 1) % params.length : 0 : rand(params.length);
  url = params[window.pageIndex][0];
  window.imgIndex = window.imgIndex != null ? (window.imgIndex + 1) % imgdivs.length : 0;
  window.iframeIndex = window.iframeIndex != null ? (window.iframeIndex + 1) % iframes.length : 0;
  if (url.match(/(png|jpg|gif)$/i)) {
    window.nextElement = imgdivs[window.imgIndex];
    return loadPage(window.nextElement.children(), url);
  } else {
    window.nextElement = iframes[window.iframeIndex];
    return loadPage(window.nextElement, url);
  }
};

displayNext = function(params, seq) {
  var sec;
  if (window.curElement == null) {
    loadNext(params, seq);
  } else {
    window.curElement.css('display', 'none');
  }
  window.curElement = window.nextElement;
  window.curElement.css('display', 'block');
  loadNext(params, seq);
  sec = params[window.pageIndex][1] || 10;
  return setTimeout(function() {
    return displayNext(params, seq);
  }, sec * 1000);
};

// バックグラウンドでページ内容をロード
loadPage = function(e, src) {
  return setTimeout(function() {
    return e.attr('src', src);
  }, 0);
};

checkAndRun = function(seq) {
  var lines, params;
  alert(sblines);
  lines = $.grep(sblines, function(x) {
    return !x.match(/^#/) && x.match(/http/);
  });
  params = lines.map(function(line) {
    var matched;
    matched = line.match(/^\s*(\[)*((https?:\/\/[^\s\]]+)(\])*(\s+(\d+))?).*$/);
    return [matched[3], matched[6]];
  });
  // matched[2].split(/ /)
  //console.log params[2][0]
  //console.log params[2][1]
  return displayNext(params, seq);
};

$(function() {
  var pairs;
  pairs = location.search.substring(1).split('&');
  return checkAndRun(pairs.indexOf('play=seq') >= 0);
});
